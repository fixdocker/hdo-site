<%= render 'progress_bar' %>

<div class="row-fluid">
  <small>
    <%= link_to '&larr; Forrige'.html_safe, edit_admin_proposition_path(@proposition.previous) if @proposition.previous %>
    <%= link_to '&rarr; Neste'.html_safe, edit_admin_proposition_path(@proposition.next), class: 'pull-right' if @proposition.next %>
  </small>
</div>

<div class="page-header">
  <div class="alert <%= @proposition.status == 'published' ? 'alert-success' : 'alert-info' %> pull-right">
    <%= t("app.propositions.status.#{@proposition.status}", count: 1) %>
  </div>
  <h1>Rediger forslag</h1>
</div>

<%= form_for [:admin, @proposition] do |f| %>
  <div class="row-fluid">
    <h4 class="span4 offset2">Stortinget</h4>
    <h4 class="span6">Holder de ord</h4>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Dato</strong></div>
    <div class="span4"><%= l @proposition.vote_time.localtime, format: :text_time %></div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Forslagstittel</strong></div>
    <div class="span4"><%= @proposition.description %></div>
    <div class="span6"><%= f.text_field :simple_description, class: 'input-xlarge' %></div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Forslagstekst</strong></div>
    <div class="span4">
      <% if @proposition.plain_body.size < 600 %>
        <%= @proposition.body.html_safe %>
      <% else %>
        <%= @proposition.plain_body.truncate(100) %>
        <a href="#" data-toggle="modal" data-target="#proposition-body">Se hele</a>
      <% end %>
    </div>
    <div class="span6"><%= f.text_area :simple_body, class: 'input-xlarge' %></div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Saker</strong></div>
    <div class="span4">
      <ul>
        <% @parliament_issues.each do |pissue| %>
          <li><%= link_to pissue.summary, pissue, target: '_blank' %></li>
        <% end %>
      </ul>
    </div>

    <div class="span6">
      <% if @proposition.votes.size > 1 %>
        <div class="alert alert-error">Forslaget brukes i flere avstemninger, og må derfor kobles via vanlig saksredigering.</div>
      <% else %>
        <%= f.select :issues, issue_options_for(@proposition), {}, class: 'input-xlarge', multiple: true, data: {placeholder: 'Velg saker'} %>
      <% end %>
      <p><small class="muted">Kommer: Mulighet til å opprette ny sak herfra.</small></p>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Forslagstiller</strong></div>
    <div class="span4">"<%= @proposition.on_behalf_of %>"</div>
    <div class="span6">
      <%= f.text_field :source_slugs %>

      <% if @proposition.source_guess.any? %>
        <small class="muted">Forslag: <%= @proposition.source_guess.join(',') %></small>
      <% end %>
    </div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Lenke til innstilling</strong></div>
    <div class="span4">Kommer...?</div>
    <div class="span6">Kommer...?</div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Lenke til referat</strong></div>
    <div class="span4">Kommer...?</div>
    <div class="span6">Kommer...?</div>
  </div>

  <div class="row-fluid">
    <div class="span2" style="text-align: right;"><strong>Sakstype</strong></div>
    <div class="span4">Kommer...?</div>
    <div class="span6">Kommer...?</div>
  </div>

  <hr>

  <div class="row-fluid">
    <div class="span6">
      <%= link_to 'Avbryt', admin_propositions_path, class: 'btn btn-warning' %></small>
    </div>

    <div class="span6">
      <%= f.submit 'Lagre', name: 'save', class: 'btn' %>
      <%= f.submit 'Lagre og publiser', name: 'save_publish', class: 'btn' %>
      <%= f.submit 'Lagre, publiser, gå til neste', name: 'save_publish_next', class: 'btn btn-primary' %>
    </div>
  </div>
<% end %>

<div id="proposition-body" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="proposition-body" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3><%= @proposition.description %></h3>
  </div>

  <div class="modal-body">
    <%= @proposition.body.html_safe %>
  </div>

  <div class="modal-footer">
     <button class="btn" data-dismiss="modal" aria-hidden="true">Lukk</button>
   </div>
</div>

<%= content_for :document_ready do %>
<script>
  $(function () { $("#proposition_issues").chosen(); })
</script>
<% end %>