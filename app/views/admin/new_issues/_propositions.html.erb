<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active">
      <a href="#proposition-connections-tab" data-toggle="tab">Koblede forslag</a>
    </li>

    <li>
      <a href="#proposition-search-tab" data-toggle="tab">Finn forslag</a>
    </li>

    <li class="pull-right">
      <%= image_tag 'spinner.gif', id: 'proposition-spinner', class: 'hidden' %>
      <div class="cart"></div>
    </li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="proposition-connections-tab">

      <% issue.proposition_connections.includes(:proposition).
                                   sort_by { |pc| pc.vote.time }.
                                   reverse.each do |connection| %>

        <div class="proposition-connection">
          <div class="row-fluid" data-expands="#proposition-connection-<%= connection.id %>">
            <div class="span3">
              <span class="expandable"></span>
              <%= l connection.vote.time, format: :short_text_time  %>
            </div>

            <div class="span9">
              <% if connection.title.present? || connection.proposition.simple_description.present? %>
                <span class="hdo-title"><%= connection.title_with_fallback %></span>
              <% else %>
                <%= connection.title_with_fallback %>
              <% end %>
            </div>
          </div>

          <div class="row-fluid proposition-form" id="proposition-connection-<%= connection.id %>">
            <div class="row-fluid">
              <div class="span6">
                <%= text_area_tag "propositions[#{connection.proposition.id}][title]", connection.title, class: 'span12' %>
              </div>

              <div class="span6">
                <label>
                  <strong>Koblet til saken?</strong>
                  <%= check_box_tag "propositions[#{connection.proposition.id}][connected]", 'true', !!connection %>
                </label>
              </div>
            </div>

            <div class="row-fluid">
              <div data-wmd-editor="<%= connection.proposition.id %>">
                <div class="span6">
                  <strong><%= PropositionConnection.human_attribute_name :comment %></strong>
                  <div id="wmd-button-bar-<%= connection.proposition.id %>"></div>
                  <%= text_area_tag "propositions[#{connection.proposition.id}][comment]", connection.comment, class: 'span12', rows: '10', id: "wmd-input-#{connection.proposition.id}" %>
                </div>

                <div class="span6">
                  <strong>Forhåndsvisning</strong>
                  <br><br>
                  <div id="wmd-preview-<%= connection.proposition.id %>" class="well"></div>
                </div>
              </div>
            </div>

          </div>
        </div>
      <% end -%>
    </div>

    <div class="tab-pane" id="proposition-search-tab">
      Ække klart ennå
    </div>
  </div>
</div>

<script name="proposition-search-template" type="text/x-handlebars-template">
  <div class="row-fluid">
    <div class="span4">
      {{> navigators}}
    </div>

    <div class="span8">
      {{> pagination}}

      {{#results}}
        <div class="search-result {{#selected}}selected{{/selected}}" data-type='proposition' data-id='{{id}}'>
          <div class="row-fluid">
            {{#if simple_description}}
              <span class="hdo-title">{{simple_description}}</span>
            {{else}}
              {{description}}
            {{/if}}
          </div>

          <div class="row-fluid">
            <small class="muted">
              {{parliament_session_name}}
              <a href="/propositions/{{id}}" target='_blank' class="pull-right">
                <img alt="Link" class="permalink" height="12" src="/assets/link.png" width="12">
              </a>
            </small>
          </div>
        </div>
      {{/results}}

      {{> pagination}}
    </div>
  </div>
</script>
