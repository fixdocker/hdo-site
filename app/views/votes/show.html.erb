<div class="page-header">
  <h1><%= @vote.subject %></h1>
</div>

<div class="row-fluid">
  <div class="span6"><%= l @vote.time.localtime, format: :text_time %></div>
  <div class="span6">
    <%= @vote.enacted? ? 'Vedtatt' : 'Ikke vedtatt' %>
    <small class="muted"><%= @vote.for_count %> for, <%= @vote.against_count %> mot, <%= @vote.absent_count %> ikke tilstede</small>
  </div>
</div>

<div class="row-fluid">
  <h4><%= ParliamentIssue.model_name.human(count: 2).capitalize %></h4>
  <ul>
    <% @parliament_issues.each do |parliament_issue| %>
      <li><%= link_to parliament_issue.summary, parliament_issue %> (<%= link_to parliament_issue.issue_type, parliament_issue.url %>)</li>
    <% end %>
  </ul>

  <% if @issues.any? %>
    <h4>HDO-saker</h4>
    <ul>
      <% @issues.each do |issue| %>
        <li><%= link_to issue.title, issue %></li>
      <% end %>
    </ul>
  <% end %>
</div>

<div class="row-fluid">
  <h3><%= Proposition.model_name.human(count: @vote.propositions.size).capitalize %></h3>
  <% if @vote.propositions.any? %>
    <%= render partial: "shared/propositions_table", locals: { vote: @vote } %>
  <% else %>
    <p>Hmm, denne avstemningen har ingen forslag koblet til seg.</p>
  <% end %>
</div>

<h3><%= VoteResult.model_name.human(count: 2).capitalize %></h3>

<% if @vote.inferred? %>
  <div class="alert alert-info"><%= I18n.t('app.votes.non_personal.inferred') %></div>
  Les mer om <%= link_to 'enstemmige vedtak', home_faq_path(anchor: 'hvordan-vet-dere-hvem-som-var-tilstede-nr-vedtaket-er-enstemmig') %>.
<% elsif @vote.non_personal? %>
  <div class="alert alert-info"><%= I18n.t('app.votes.non_personal.unknown') %></div>
<% end %>

<% if @vote.vote_results.size > 0 %>
  <div class="row-fluid state-header">
    <h5 class="span4">For</h5>
    <h5 class="span4">Mot</h5>
    <h5 class="span4">Ikke tilstede</h5>
  </div>

  <% @results_by_party.each do |party, results_by_status| %>
    <div class="row-fluid" data-toggle="collapse" data-target='#vote-results-<%= party.slug %>'>
      <% results_by_status.each do |status, results| %>
        <div class="span4">
          <% if results.any? %>
            <%= image_tag party.logo, alt: party.name, width: '24', height: '24' %>
            <span class="party-name"><%= party.name %> (<%= results.size %>)</span>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="row-fluid collapse" id="vote-results-<%= party.slug %>">
      <% results_by_status.each do |_, results| %>
        <div class="span4">
          <% results.each do |result| %>
            <p>
              <%= link_to result.representative.name, result.representative %>
              <%= '(utbryter)' if result.rebel? %>
            </p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% end %>
<% else %>
<% end %>