<% page_title "#{@issue.title} - #{t('app.issues.title')} - #{t('app.title')}" %>
<% metadata[:description] = @issue.description %>
<% metadata[:type] = 'article' %>
<% metadata[:url] = issue_url(@issue) %>

<%= render partial: 'temp_toggles' %>

<article class="issue-timeline">
  <div class="page-header">
    <h1 class="issue-title"><%= @issue.title %></h1>
    <%= render partial: 'aside', locals: { issue: @issue } %>
  </div>

  <p class="issue-description"><%= @issue.description %></p>

  <% @issue.periods.each do |period| %>
  <div class="positions">
    <h3>Oppsummering av <%= period.name %></h3>
    <% period.positions.each do |position| %>
      <div class="row-fluid">
        <div class="span2">
          <% position.parties.each do |party| %>
            <%= image_tag party.logo.versions[:medium], style: 'max-width: 50px', class: 'pull-right', alt: "#{party.name}s logo" %>
          <% end %>
        </div>

        <div class="span10 position">
          <h4><%= position.title %></h4>
          <p class="position-description"><%= position.description %></p>
        </div>
      </div>

      <div class="row-fluid accountability">
        <div class="offset2 span10">

          <ul class="unstyled">
            <% position.parties.each do |party| %>
              <li>
                <%= party.accountability %>

                <% if party.promises.any? %>
                  <a data-toggle="collapse" data-target="#<%= [party.slug, period.name, 'promises'].join('-') %>" onclick="return false;" href="#" >
                    Se l√∏ftene
                  </a>

                  <div class="collapse promises" id="<%= [party.slug, period.name, 'promises'].join('-') %>">
                    <ul>
                      <% party.promises.each do |p| %>
                        <li class="promise-<%= p.status %> <%= 'muted' if p.related? %>"><%= p.promise.body %></li>
                      <% end %>
                    </ul>
                  </div>
                <% end %>
              </li>
            <% end %>
          </ul>

        </div>
      </div>
    <% end %>
  </div>

  <div class="timeline">
    <% period.days.each do |day| %>
      <div class="row-fluid timeline-entry">
        <div class="span6"></div>
        <div class="date span6">
          <div class="day"><%= day.day %></div>
          <div class="month"><%= day.month %></div>
        </div>
      </div>

      <% day.votes.in_groups_of(2, false).each do |votes| %>
      <div class="row-fluid votes">
      <% votes.each do |vote| %>
        <div class="span6 vote">
          <p class="vote-title"><%= vote.title %></p>
          <div class="vote-detail"><%= markdown(vote.comment).html_safe %></div>
        </div>
        <% end %>
      </div>
      <% end %>
    <% end %>
  </div>
  <% end %>
</article>
