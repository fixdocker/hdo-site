<% page_title "#{@issue.title} - #{t('app.issues.title')} - #{t('app.title')}" %>
<% metadata[:description] = @issue.description %>
<% metadata[:type] = 'article' %>
<% metadata[:url] = issue_url(@issue) %>

<div id="admin-info"></div>
<%= content_for :document_ready do %>
  <script>
  $(document).ready(function() {
    if (HDO.ssl && 'https:' != document.location.protocol) {
      return;
    }

    $.ajax({
      url: '<%= admin_info_issue_path(@issue) %>',
      type: 'GET',
      dataType: 'html',
      success: function(data, textStatus, xhr) { $("#admin-info").html(data); }
    });
  });
  </script>
<% end %>

<% cache @issue do %>
  <div class="page-header">
    <h1 class="issue-title"><%= @issue.title %></h1>
    <%= render partial: 'aside', locals: { issue: @issue } %>
  </div>

  <p class="issue-description"><%= @issue.description %></p>

  <figure class="valence">
    <figcaption class="muted">
      <%= render partial: 'shared/social_sharing' %>
      <p><%= @issue.explanation %></p>
    </figcaption>

    <% @issue.positions.each do |position| %>
      <div class="row-fluid position">
        <div class="span3">
          <div class="parties_<%= position.parties.size %>">
            <% position.parties.sort_by(&:name).each do |party| %>
              <a href="#<%= party.slug %>">
                <%= image_tag party.logo.versions[:medium], alt: "#{party.name}s logo", class: "party-logo" %>
              </a>
            <% end %>
          </div>
        </div>

        <div class="span7">
          <h4><%= position.title %></h4>
          <p><%= position.description %></p>
        </div>
      </div>
    <% end %>
  </figure>

  <hr>

  <div>
    <% @issue.party_groups.each do |party_group| %>
      <% party_group.parties.each do |party| %>
        <% unless party.external_id == 'MDG' %>
          <%= render partial: 'issue_party', locals: { issue: @issue, party: party, party_group: party_group } %>
        <% end %>
      <% end %>
    <% end %>
  </div>

<% end # cache %>
